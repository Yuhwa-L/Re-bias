<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Re-Bias Shorts Demo</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        background: #000;
        color: #f9fafb;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        overflow: hidden; /* Disable full page scroll */
      }

      /* ðŸ”² iPhone-like screen frame (position fully fixed) */
      .shorts-frame {
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: min(100vw, 430px); /* Approx. iPhone width */
        height: 100vh; /* Full device height */
        background: #000;
        overflow: hidden;
      }

      .shorts-track {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        transition: transform 0.35s ease-out;
      }

      /* Each slide is one full screen inside the frame */
      .short-slide {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;             /* ðŸ”¥ Split into top/bottom regions using flex */
        flex-direction: column;
      }

      /* Top: summary region (initially 0% height) */
      .summary-region {
        flex: 0 0 0%;              /* ðŸ”¥ Start at 0% (hidden) */
        max-height: 0;
        overflow: hidden;
        transition: flex-basis 0.25s ease-out, max-height 0.25s ease-out;
        background: transparent;
      }

      /* Bottom: video region (initially 100%) */
      .video-region {
        flex: 1 1 auto;           /* ðŸ”¥ Initially video takes full height */
        position: relative;
        overflow: hidden;
        background: #000;
        transition: flex-basis 0.25s ease-out;
      }

      /* âœ… When summary is open:
         - summary-region becomes 50%
         - video-region becomes 50% */
      .short-slide.summary-open .summary-region {
        flex: 0 0 50%;            /* ðŸ”§ Top 50% */
        max-height: 50%;
      }

      .short-slide.summary-open .video-region {
        flex: 0 0 50%;            /* ðŸ”§ Bottom 50% */
      }

      /* Actual summary box (fills summary-region) */
      .summary-sheet {
        height: 100%;
        background: rgba(15, 23, 42, 0.97);
        border-radius: 0 0 18px 18px;
        padding: 12px 16px 18px;
        display: flex;
        flex-direction: column;
      }

      .summary-handle {
        width: 40px;
        height: 4px;
        border-radius: 999px;
        background: #4b5563;
        margin: 4px auto 12px;
      }

      .summary-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 6px;
        gap: 8px;
      }

      .summary-title {
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #9ca3af;
      }

      .summary-close {
        border: none;
        border-radius: 999px;
        padding: 4px 10px;
        font-size: 11px;
        cursor: pointer;
        background: #111827;
        color: #e5e7eb;
      }

      .summary-body {
        font-size: 13px;
        line-height: 1.5;
        white-space: pre-line;
        color: #e5e7eb;
        margin-top: 6px;
        flex: 1 1 auto;
        overflow-y: auto;
      }

      /* Video wrapper always lives inside video-region */
      .short-video-wrapper {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.25s ease-out;
        transform-origin: center center;
        background: #000;
      }

      video.short-video {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
        background: #000;
      }

      .overlay-top-gradient {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 20%;
        background: linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.6),
          transparent
        );
        pointer-events: none;
      }

      /* âœ… Bias banner: fixed inside video region only */
      .bias-banner {
        position: absolute;
        top: 8%;
        left: 6%;
        border: none;
        border-radius: 999px;
        padding: 6px 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(17, 24, 39, 0.9);
        color: #f9fafb;
        cursor: pointer;
        font-size: 12px;
        pointer-events: auto;
        z-index: 6;
      }

      .bias-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #f97316;
      }

      .bias-score {
        font-weight: 600;
      }

      /* âœ… Only the video scales (summary stays fixed)
         - When summary is open, video inside bottom 50% shrinks slightly */
      .short-slide.summary-open .short-video-wrapper {
        /* ðŸ”§ Video size/position:
           - scale(0.9): almost full / 0.8: more padding
           - translateY(5%): slight downward shift within bottom region */
        transform: scale(0.9) translateY(5%);
      }

      .sound-hint {
        position: absolute;
        bottom: 6%;
        left: 50%;
        transform: translateX(-50%);
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 12px;
        background: rgba(0, 0, 0, 0.65);
        color: #f9fafb;
        z-index: 10;
      }
      .sound-hint.hidden {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s ease-out;
      }
    </style>
  </head>
  <body>
    <!-- ðŸ”² Frame: fully fixed position, only inner layout changes -->
    <div class="shorts-frame">
      <div class="shorts-track" id="shortsTrack">
        <!-- Slide 1 -->
        <section class="short-slide" data-index="0">
          <!-- Top region: summary (0% at first, 50% when summary-open) -->
          <div class="summary-region">
            <div class="summary-sheet">
              <div class="summary-handle"></div>
              <div class="summary-header">
                <div class="summary-title">AI Neutral Summary</div>
                <button class="summary-close" type="button">Close</button>
              </div>
              <div class="summary-body">
This video strongly supports a particular political group and policy,
while barely addressing data and arguments from the opposing side.

According to AI analysis,
- It uses framing that portrays the opposing side as emotional or irrational,
- And over-attributes the problem's cause to a single group.

From a more balanced perspective,
- Youâ€™d review both the benefits and the costs/side effects of the policy, and
- Consider economic, safety, and human-rights concerns raised by other groups.
              </div>
            </div>
          </div>

          <!-- Bottom region: video -->
          <div class="video-region">
            <div class="short-video-wrapper">
              <video
                class="short-video"
                src="../video/1.mp4"
                playsinline
                autoplay
                muted
                loop
              ></video>

              <div class="overlay-top-gradient"></div>

              <button class="bias-banner">
                <span class="bias-dot"></span>
                <span class="bias-score">72%</span>
              </button>
            </div>
          </div>
        </section>

        <!-- Slide 2 -->
        <section class="short-slide" data-index="1">
          <div class="summary-region">
            <div class="summary-sheet">
              <div class="summary-handle"></div>
              <div class="summary-header">
                <div class="summary-title">AI Neutral Summary</div>
                <button class="summary-close" type="button">Close</button>
              </div>
              <div class="summary-body">
This video focuses on one main perspective,
but briefly acknowledges concerns and limitations of the opposing view.

AI analysis suggests that:
- The evidence presented mostly aligns with real data, but
- It doesnâ€™t fully cover costs, implementation difficulty, or long-term impact.

For balanced understanding,
youâ€™d want to compare multiple data sources and the opposing sideâ€™s reasoning.
              </div>
            </div>
          </div>

          <div class="video-region">
            <div class="short-video-wrapper">
              <video
                class="short-video"
                src="../video/2.mp4"
                playsinline
                loop
              ></video>

              <div class="overlay-top-gradient"></div>

              <button class="bias-banner">
                <span class="bias-dot"></span>
                <span class="bias-score">35%</span>
              </button>
            </div>
          </div>
        </section>
      </div>

      <div class="sound-hint" id="soundHint">
      </div>
    </div>

    <script>
      const track = document.getElementById("shortsTrack");
      const slides = Array.from(document.querySelectorAll(".short-slide"));
      const videos = slides.map((s) => s.querySelector("video.short-video"));
      const soundHint = document.getElementById("soundHint");

      let currentIndex = 0;

      function updateSlidePosition() {
        track.style.transform = `translateY(-${currentIndex * 100}%)`;
      }

      function playCurrentVideo() {
        videos.forEach((v, i) => {
          if (i === currentIndex) {
            v.play().catch(() => {});
          } else {
            v.pause();
            v.currentTime = 0;
          }
        });
      }

      function goTo(index) {
        if (index < 0 || index >= slides.length) return;
        currentIndex = index;
        updateSlidePosition();
        playCurrentVideo();
      }

      window.addEventListener("load", () => {
        updateSlidePosition();
        playCurrentVideo();
      });

      // Swipe handling (based on frame)
      let startY = 0;
      let deltaY = 0;
      let isDragging = false;

      const frame = document.querySelector(".shorts-frame");

      frame.addEventListener("touchstart", (e) => {
        if (e.touches.length !== 1) return;
        startY = e.touches[0].clientY;
        deltaY = 0;
        isDragging = true;
      });

      frame.addEventListener("touchmove", (e) => {
        if (!isDragging) return;
        const currentY = e.touches[0].clientY;
        deltaY = currentY - startY;
      });

      frame.addEventListener("touchend", () => {
        if (!isDragging) return;
        const threshold = 60;
        if (deltaY < -threshold) {
          goTo(currentIndex + 1);
        } else if (deltaY > threshold) {
          goTo(currentIndex - 1);
        }
        isDragging = false;
        deltaY = 0;
      });

      // Desktop wheel support
      let wheelLocked = false;
      frame.addEventListener("wheel", (e) => {
        if (wheelLocked) return;
        wheelLocked = true;
        const threshold = 20;
        if (e.deltaY > threshold) {
          goTo(currentIndex + 1);
        } else if (e.deltaY < -threshold) {
          goTo(currentIndex - 1);
        }
        setTimeout(() => {
          wheelLocked = false;
        }, 400);
      });

      // Bias banner â†’ open summary (frame stays fixed, only layout splits)
      document.querySelectorAll(".bias-banner").forEach((btn, idx) => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          slides[idx].classList.add("summary-open");
        });
      });

      // Close summary
      document.querySelectorAll(".summary-close").forEach((btn, idx) => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          slides[idx].classList.remove("summary-open");
        });
      });

      // First user interaction â†’ enable sound
      let soundEnabled = false;
      function enableSound() {
        if (soundEnabled) return;
        soundEnabled = true;
        videos.forEach((v) => {
          v.muted = false;
        });
        playCurrentVideo();
        if (soundHint) {
          soundHint.classList.add("hidden");
          setTimeout(() => {
            soundHint.style.display = "none";
          }, 300);
        }
        document.removeEventListener("click", enableSound);
        document.removeEventListener("touchstart", enableSound);
      }

      document.addEventListener("click", enableSound);
      document.addEventListener("touchstart", enableSound);
    </script>
  </body>
</html>
